# Databases & Redis in Production
## A Platform Engineer / DevOps Engineer Practical Guide (Interview + Real World)

This document consolidates **everything we discussed** about:
- Databases (SQL & NoSQL)
- Redis cache
- Production architecture
- High availability
- Backups, RPO, RTO
- Kubernetes deployment patterns
- Interviewâ€‘style explanations

This is written from a **platform ownership mindset**, not DBA theory.

---

## 1. Mental Model (Start Here)

- **Database** = source of truth (correctness matters)
- **Redis** = performance layer (speed matters)
- **Kubernetes** = scheduling + networking + failure handling
- **Platform Engineer** = makes failures invisible

---

## 2. Database vs Redis vs Storage

| Component | Purpose | Data Type | Can lose data? |
|--------|-------|---------|---------------|
| Database (Postgres) | Correct data | Structured | âŒ No |
| Redis Cache | Speed | Temporary | âœ… Yes |
| Blob Storage | Files | Unstructured | âŒ No |

---

## 3. Relational Database (Postgres) â€“ Production Setup

### 3.1 Primary + Replica Architecture

```
Application
    |
    | writes
    v
Primary Postgres  ---->  Replica Postgres
```

- Primary handles **writes**
- Replica continuously copies data
- Replica is used for:
  - Failover
  - Read scaling (nonâ€‘critical)

---

### 3.2 Why Replica Exists

- Not for backup
- For **high availability**

If primary fails:
- Replica promoted
- Application reconnects

---

## 4. Redis Cache â€“ Production Architecture

### 4.1 Redis Placement

Redis always sits **between application and database**.

```
User â†’ App â†’ Redis â†’ App â†’ User
              â†“ (miss)
           Database
```

---

### 4.2 Redis Primary + Replica

```
App â†’ Redis Primary â†’ Redis Replica
```

- Primary handles writes
- Replicas handle reads
- If primary fails â†’ replica promoted

Redis replicas are for:
- Availability
- Read scaling

Redis replicas are **NOT backups**.

---

## 5. HPA and Redis â€“ Important Truth

### Do we use HPA for Redis?

âŒ **Not for scaling data**

HPA:
- Scales stateless workloads
- Cannot split inâ€‘memory data

### What we do instead

- Fixed replicas (hardâ€‘coded)
- Redis Cluster (sharding) for scale
- Add replicas for HA, not HPA

ðŸ‘‰ **Redis scaling is intentional, not automatic**.

---

## 6. Kubernetes Deployment Patterns

### 6.1 Why Redis Needs Dedicated Nodes

Redis is **memoryâ€‘intensive**.

So we use:
- Dedicated node pool
- High RAM nodes
- Taints + tolerations

This prevents:
- App pods stealing memory
- OOMKills

---

### 6.2 Node Selection (Conceptual)

```
[ Memory Node Pool ]  â† Redis only
[ App Node Pool ]     â† Applications
```

Redis pods:
- NodeSelector â†’ memory nodes
- Resource limits set

---

## 7. Failure Scenarios (Real Production)

### 7.1 Database Primary Down

What happens:
- Primary crashes
- Replica promoted
- App reconnects via DNS

Platform responsibility:
- Automatic failover
- Stable endpoint
- Retry logic

---

### 7.2 Redis Eviction

Cause:
- Memory full

Effect:
- Cache miss
- DB hit
- Possible DB overload

Prevention:
- TTL on all keys
- Proper sizing
- Dedicated nodes
- Monitoring eviction rate

---

### 7.3 Replica Lag

Replica lag means:
- Replica has old data

Danger:
- Wrong reads
- Stale cache

Mitigation:
- Critical reads â†’ primary
- Cache filled from primary
- Monitor lag

---

## 8. High Availability Concepts

### Activeâ€‘Passive

```
Active DB
   â†“
Passive DB
```

- Simple
- Strong consistency

---

### Activeâ€‘Active

```
App â†’ DBâ€‘1
App â†’ DBâ€‘2
```

- Used for caches
- Eventual consistency
- Complex conflict resolution

---

## 9. Backups, RPO, RTO (VERY IMPORTANT)

### Backups

- Automated
- Stored offâ€‘cluster
- Tested restores

---

### RPO (Recovery Point Objective)

> How much data loss is acceptable

Example:
- RPO = 5 minutes
- Lose max 5 minutes of data

---

### RTO (Recovery Time Objective)

> How fast system must recover

Example:
- RTO = 10 minutes
- System must be usable in 10 mins

---

## 10. How Applications Connect (Networking)

### Kubernetes Service + DNS

```
App â†’ Service â†’ DB / Redis Pod
```

Why:
- Pods change IPs
- Services are stable

Apps never connect to pod IPs.

---

## 11. Security Model

Layers:
- Private networking
- TLS encryption
- Identityâ€‘based auth

Golden rule:
> No public DBs. Ever.

---

## 12. What Production Really Looks Like

- Fixed replica counts
- Explicit scaling decisions
- Monitoring everywhere
- Failures tested in nonâ€‘prod

Production is **predictable**, not magical.

---

## 13. Interviewâ€‘Style Questions & Answers

### Q: Why not use Redis as DB?
A: Redis is volatile and can evict data. DB is source of truth.

---

### Q: Do you use HPA for Redis?
A: No. Redis scaling requires sharding or replicas, not HPA.

---

### Q: What happens if Redis is down?
A: System degrades gracefully and reads from DB with protection.

---

### Q: Replica vs Backup?
A: Replica = availability. Backup = recovery.

---

## 14. Final Platform Engineer Mindset

- Failures are normal
- Automation beats heroics
- Databases must be boring

---

**If you can explain this document calmly, you are interviewâ€‘ready.**

